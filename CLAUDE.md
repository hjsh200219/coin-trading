# CLAUDE.md

ì´ íŒŒì¼ì€ Claude Code (claude.ai/code)ê°€ ì´ ì €ì¥ì†Œì—ì„œ ì‘ì—…í•  ë•Œ ì°¸ê³ í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ”´ ì¤‘ìš” ê·œì¹™ (CRITICAL RULES)

### ì–¸ì–´ ì„¤ì •
- **ëª¨ë“  ë‹µë³€ì€ í•œê¸€ë¡œ ì‘ì„±**

### ë°ì´í„°ë² ì´ìŠ¤ ë³´í˜¸
- **ì ˆëŒ€ ê¸ˆì§€**: ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ë˜ëŠ” ì „ì²´ ì‚­ì œ ì‘ì—…
- **ì ˆëŒ€ ê¸ˆì§€**: DROP TABLE, TRUNCATE TABLE ë“± ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥ì„±ì´ ìˆëŠ” SQL ì‹¤í–‰
- **í—ˆìš©**: ê°œë³„ ì»¬ëŸ¼ ì¶”ê°€ ALTER TABLE ëª…ë ¹ì–´
- **í—ˆìš©**: ì¸ë±ìŠ¤ ìƒì„±/ì‚­ì œ
- **ë°˜ë“œì‹œ í™•ì¸**: ì¤‘ìš”í•œ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì „ ì‚¬ìš©ì ìŠ¹ì¸ í•„ìš”

### ì½”ë“œ í’ˆì§ˆ ì ˆëŒ€ ê·œì¹™
- **ğŸš« ESLint Disable ì ˆëŒ€ ê¸ˆì§€**:
  - `eslint-disable`, `eslint-disable-line`, `eslint-disable-next-line` ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€
  - `// @ts-ignore`, `// @ts-nocheck` ë“± TypeScript ì²´í¬ ë¹„í™œì„±í™” ê¸ˆì§€
  - **ëª¨ë“  ë¦°íŠ¸ ì—ëŸ¬ëŠ” ë°˜ë“œì‹œ ì½”ë“œ ìˆ˜ì •ìœ¼ë¡œë§Œ í•´ê²°**
- ì½”ë“œ ìˆ˜ì • í›„ì—ëŠ” ë°˜ë“œì‹œ `npm run lint` ì‹¤í–‰í•˜ì—¬ ì—ëŸ¬ í™•ì¸ ë° ìˆ˜ì •
- ë¦°íŠ¸ ì—ëŸ¬ê°€ ìˆëŠ” ìƒíƒœë¡œ ì‘ì—… ì™„ë£Œ ê¸ˆì§€

### íŒŒì¼ êµ¬ì¡° ê·œì¹™
- **SQL íŒŒì¼ ê´€ë¦¬**:
  - ëª¨ë“  Supabase SQL íŒŒì¼ì€ `sql/` í´ë”ì— ì €ì¥
  - ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ëª…: `YYYYMMDD_description.sql` í˜•ì‹ ì‚¬ìš©
  - íŒŒì¼ ë‚´ ì£¼ì„ìœ¼ë¡œ ëª©ì ê³¼ ì˜ì¡´ì„± ëª…ì‹œ

- **UI ì»´í¬ë„ŒíŠ¸ ê·œì¹™**:
  - **í•„ìˆ˜**: UI ìš”ì†Œ êµ¬í˜„ ì‹œ `src/components/ui/` í´ë”ì˜ ê³µí†µ ì»´í¬ë„ŒíŠ¸ ìš°ì„  ì‚¬ìš©
  - í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ê°€ ì—†ì„ ê²½ìš° `src/components/ui/`ì— ìƒˆë¡œìš´ ê³µí†µ ì»´í¬ë„ŒíŠ¸ ìƒì„±
  - í˜ì´ì§€ë³„ íŠ¹í™” ì»´í¬ë„ŒíŠ¸ë§Œ í˜ì´ì§€ ë””ë ‰í† ë¦¬ì— ìœ„ì¹˜
  - ê³µí†µ UI ì»´í¬ë„ŒíŠ¸ëŠ” variant, size ë“±ì˜ propsë¡œ ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤ ì§€ì›

- **ë¬¸ì„œ ê´€ë¦¬**:
  - ëª¨ë“  PRD(Product Requirement Document) íŒŒì¼ì€ `.docs/` í´ë”ì— ì €ì¥
  - ê¸°ëŠ¥ ëª…ì„¸ì„œ, ìš”êµ¬ì‚¬í•­ ë¬¸ì„œ, ì„¤ê³„ ë¬¸ì„œ ë“± í”„ë¡œì íŠ¸ ë¬¸ì„œí™”
  - íŒŒì¼ëª…: `YYYYMMDD_feature_name.md` í˜•ì‹ ê¶Œì¥

## ê°œë°œ ëª…ë ¹ì–´

```bash
# ê°œë°œ ì„œë²„
npm run dev              # ê°œë°œ ì„œë²„ ì‹œì‘ (http://localhost:3000)

# ë¹Œë“œ & í”„ë¡œë•ì…˜
npm run build           # í”„ë¡œë•ì…˜ ë¹Œë“œ
npm start               # í”„ë¡œë•ì…˜ ì„œë²„ ì‹œì‘

# ë¦°íŒ…
npm run lint            # ESLint ì‹¤í–‰

# ìºì‹œ ì‚­ì œ (í•« ë¦¬ë¡œë“œ ì‹¤íŒ¨ ì‹œ)
rm -rf .next && npm run dev

# ëª¨ë“  ê°œë°œ ì„œë²„ ì¢…ë£Œ
for port in 3000 3001 3002 4000 5000 5173 8000 8080 8081 9000; do
  lsof -ti:$port | xargs kill -9 2>/dev/null
done
```

## ì•„í‚¤í…ì²˜ ê°œìš”

### ê¸°ìˆ  ìŠ¤íƒ
- **í”„ë ˆì„ì›Œí¬**: Next.js 15 (App Router) with React Server Components
- **ì–¸ì–´**: TypeScript (strict mode)
- **ìŠ¤íƒ€ì¼ë§**: Tailwind CSS (ì»¤ìŠ¤í…€ ë‹¤í¬ í…Œë§ˆ - Supabase ìŠ¤íƒ€ì¼)
- **ë°ì´í„°ë² ì´ìŠ¤**: Supabase (PostgreSQL)
- **ì¸ì¦**: Supabase Auth (Google OAuth)
- **ë°°í¬**: Vercel

### ì¸ì¦ í”Œë¡œìš°

1. **OAuth ë¡œê·¸ì¸** (`/login`): Supabase Authë¥¼ í†µí•œ Google OAuth
2. **ì¸ì¦ ì½œë°±** (`/app/auth/callback/route.ts`):
   - ì½”ë“œë¥¼ ì„¸ì…˜ìœ¼ë¡œ êµí™˜
   - `user_profiles` ë ˆì½”ë“œê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„± (ê¸°ë³¸ê°’ `user_type: 'quest'`)
3. **ë³´í˜¸ëœ ë¼ìš°íŠ¸**: `/login`ì„ ì œì™¸í•œ ëª¨ë“  í˜ì´ì§€ëŠ” `AppLayout`ì„ í†µí•œ ì¸ì¦ í•„ìš”

### ì‚¬ìš©ì íƒ€ì… ì‹œìŠ¤í…œ

ì„¸ ê°€ì§€ ì‚¬ìš©ì íƒ€ì…ê³¼ ê¶Œí•œ ìˆ˜ì¤€:
- `admin`: `/admin` ì‚¬ìš©ì ê´€ë¦¬ í¬í•¨ ì „ì²´ ì ‘ê·¼ ê¶Œí•œ
- `member`: ì¼ë°˜ ì¸ì¦ ì‚¬ìš©ì
- `quest`: ì‹ ê·œ ì‚¬ìš©ì ê¸°ë³¸ê°’ (ê²ŒìŠ¤íŠ¸ ë ˆë²¨)

ì‚¬ìš©ì íƒ€ì…ì€ `user_profiles` í…Œì´ë¸”ì— ì €ì¥ë˜ë©° RLS ì •ì±…ìœ¼ë¡œ ê°•ì œë©ë‹ˆë‹¤.

### ë ˆì´ì•„ì›ƒ ì•„í‚¤í…ì²˜

**ì¤‘ì•™ ì§‘ì¤‘ì‹ ë ˆì´ì•„ì›ƒ íŒ¨í„´**:
- `AppLayout` ì»´í¬ë„ŒíŠ¸ê°€ ëª¨ë“  ì¸ì¦ëœ í˜ì´ì§€ë¥¼ ê°ì‹¸ê¸°
- ì¸ì¦ ì²´í¬ ì²˜ë¦¬ ë° ë¯¸ì¸ì¦ ì‹œ `/login`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- ì‚¬ìš©ì í”„ë¡œí•„ì„ ê°€ì ¸ì™€ì„œ `Navigation`ì— ì „ë‹¬
- ëª¨ë“  í˜ì´ì§€ì— ì¼ê´€ëœ max-width (`max-w-7xl`) ì„¤ì •
- ëª¨ë“  í˜ì´ì§€ëŠ” `<AppLayout>{content}</AppLayout>` ë˜í¼ ì‚¬ìš©

**ë„¤ë¹„ê²Œì´ì…˜ ì‹œìŠ¤í…œ**:
- ë°˜ì‘í˜• ë””ìì¸: ë°ìŠ¤í¬í†± ê°€ë¡œ ë©”ë‰´, ëª¨ë°”ì¼ í–„ë²„ê±° ë“œë¡­ë‹¤ìš´
- ë™ì  í˜ì´ì§€ íƒ€ì´í‹€: í™ˆì—ì„œëŠ” "Coin Trading", ë‹¤ë¥¸ ë¼ìš°íŠ¸ì—ì„œëŠ” í˜ì´ì§€ ì´ë¦„ í‘œì‹œ
- `parent` ì†ì„±ìœ¼ë¡œ ê³„ì¸µì  íƒ€ì´í‹€ ì§€ì›: "ë©”ì¸ > ì„œë¸Œ"
- ê´€ë¦¬ì ë©”ë‰´ í•­ëª©ì€ `user_type: 'admin'`ì¼ ë•Œë§Œ í‘œì‹œ
- ë°ìŠ¤í¬í†± ë° ëª¨ë°”ì¼ ë·° ëª¨ë‘ì— ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ í†µí•©

### Supabase í´ë¼ì´ì–¸íŠ¸ íŒ¨í„´

**ë‘ ê°€ì§€ í´ë¼ì´ì–¸íŠ¸ íƒ€ì…**:
1. **ì„œë²„ í´ë¼ì´ì–¸íŠ¸** (`@/lib/supabase/server`): Server Componentsì™€ Server Actionsìš©
   - ì¿ í‚¤ í†µí•©ê³¼ í•¨ê»˜ `createServerClient` ì‚¬ìš©
   - ë¹„ë™ê¸° í•¨ìˆ˜: `await createClient()`

2. **ë¸Œë¼ìš°ì € í´ë¼ì´ì–¸íŠ¸** (`@/lib/supabase/client`): Client Componentsìš©
   - `createBrowserClient` ì‚¬ìš©
   - ë™ê¸° í•¨ìˆ˜: `createClient()`

**ì‚¬ìš©ë²•**:
- Server Components: í•­ìƒ ì„œë²„ í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
- Client Components: í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì‘ì—…ì— ë¸Œë¼ìš°ì € í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
- Server Actions: ë³€ê²½ ì‘ì—…ì— ì„œë²„ í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©

### ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜

**ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸**:
- `AppLayout`: ì¸ì¦ + ë„¤ë¹„ê²Œì´ì…˜ì„ í¬í•¨í•œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ë ˆì´ì•„ì›ƒ
- `Navigation`: ì‚¬ìš©ì ì •ë³´ì™€ ë¡œê·¸ì•„ì›ƒì´ í¬í•¨ëœ ë°˜ì‘í˜• ë„¤ë¹„ê²Œì´ì…˜

**UI ì»´í¬ë„ŒíŠ¸** (`src/components/ui/`):
- ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì›ì ì»´í¬ë„ŒíŠ¸: `Button`, `Input`, `Card`
- variantì™€ size propsë¡œ ì¼ê´€ëœ ìŠ¤íƒ€ì¼ë§
- ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” Tailwind í…Œë§ˆ ì»¬ëŸ¬ ì‚¬ìš©
- **ì¤‘ìš”**: ìƒˆë¡œìš´ UI ìš”ì†Œ í•„ìš” ì‹œ ì´ í´ë”ì— ê³µí†µ ì»´í¬ë„ŒíŠ¸ë¡œ ìƒì„±

**í˜ì´ì§€ë³„ ì»´í¬ë„ŒíŠ¸**:
- í˜ì´ì§€ ë””ë ‰í† ë¦¬ì— ìœ„ì¹˜ (ì˜ˆ: `/app/my-page/ProfileCard.tsx`)
- **ë°˜ë“œì‹œ** `src/components/ui/`ì˜ ê³µí†µ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±
- í˜ì´ì§€ì—ë§Œ íŠ¹í™”ëœ ë¡œì§ì´ ìˆì„ ë•Œë§Œ ë³„ë„ ì»´í¬ë„ŒíŠ¸ ìƒì„±

### TypeScript ê²½ë¡œ ë³„ì¹­

`src/`ì˜ ëª¨ë“  ì„í¬íŠ¸ì— `@/*` ì‚¬ìš©:
```typescript
import { createClient } from '@/lib/supabase/server'
import Button from '@/components/ui/Button'
```

### ìŠ¤íƒ€ì¼ë§ ì‹œìŠ¤í…œ

**Tailwind ì»¤ìŠ¤í…€ í…Œë§ˆ** (ê¸°ë³¸ ë‹¤í¬ ëª¨ë“œ):
```javascript
colors: {
  background: '#1c1c1c',      // ë©”ì¸ ë°°ê²½
  foreground: '#ededed',       // ë©”ì¸ í…ìŠ¤íŠ¸
  brand: '#3ecf8e',           // ì£¼ìš” ê°•ì¡°ìƒ‰ (ë…¹ìƒ‰)
  border: '#2e2e2e',          // ê¸°ë³¸ í…Œë‘ë¦¬
  surface: {
    DEFAULT: '#181818',        // ì¹´ë“œ ë°°ê²½
    75: '#1f1f1f',
    100: '#262626',
  }
}
```

### Server Actions íŒ¨í„´

ë³€ê²½ ì‘ì—…(í”„ë¡œí•„ ì—…ë°ì´íŠ¸, ê´€ë¦¬ì ì‘ì—…)ì„ ìœ„í•œ Server Actions:
```typescript
const updateProfile = async (formData: FormData) => {
  'use server'
  // ì„œë²„ supabase í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
  const supabase = await createClient()
  // ë³€ê²½ ì‘ì—… ìˆ˜í–‰
  // revalidatePath()ë¡œ ìºì‹œ ì—…ë°ì´íŠ¸
  // redirect()ë¡œ ë„¤ë¹„ê²Œì´ì…˜
}
```

ë¡œë”© ìƒíƒœê°€ ìˆëŠ” í¼ ì œì¶œ:
```typescript
// ì œì¶œ ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ì—ì„œ useFormStatus() í›… ì‚¬ìš©
function SubmitButton() {
  const { pending } = useFormStatus()
  return <Button disabled={pending}>{pending ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}</Button>
}
```

### ì´ë¯¸ì§€ ì„¤ì •

í—ˆìš©ëœ ì›ê²© ì´ë¯¸ì§€ ë„ë©”ì¸:
- `https://lh3.googleusercontent.com/a/**` (Google í”„ë¡œí•„ ì‚¬ì§„)

ìƒˆ ë„ë©”ì¸ì€ `next.config.js`ì˜ `remotePatterns` ë°°ì—´ì— ì¶”ê°€í•˜ì„¸ìš”.

## ì£¼ìš” íŒ¨í„´

### ìƒˆë¡œìš´ ë³´í˜¸ëœ ë¼ìš°íŠ¸ ì¶”ê°€í•˜ê¸°

1. `src/app/[route]/page.tsx`ì— í˜ì´ì§€ ìƒì„±
2. `<AppLayout>`ìœ¼ë¡œ ì»¨í…ì¸  ê°ì‹¸ê¸°
3. `Navigation` navItems ë°°ì—´ì— ë¼ìš°íŠ¸ ì¶”ê°€
4. ì„ íƒì‚¬í•­: ì„œë¸Œë©”ë‰´ ë¸Œë ˆë“œí¬ëŸ¼ì„ ìœ„í•œ `parent` ì†ì„± ì¶”ê°€

### ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥

ë‹¤ìŒì—ì„œ `user_type === 'admin'` í™•ì¸:
- ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ (ì¡°ê±´ë¶€ ë Œë”ë§)
- í˜ì´ì§€ ë ˆë²¨ ì ‘ê·¼ ì œì–´ (ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸)
- Server actions (ë³€ê²½ ì „ user_type í™•ì¸)

### Server Actionsì™€ í¼ íŒ¨í„´

```typescript
// page.tsxì—ì„œ (Server Component)
async function serverAction(formData: FormData) {
  'use server'
  const supabase = await createClient()
  // ... ë³€ê²½ ë¡œì§
  revalidatePath('/current-path')
  redirect('/current-path')
}

// í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬
<ClientForm action={serverAction} />

// ClientFormì—ì„œ (Client Component)
<form action={action}>
  <Input name="field" />
  <SubmitButton /> {/* useFormStatus ì‚¬ìš© */}
</form>
```

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ê·œì¹™

- í…Œì´ë¸”: `user_profiles` (`users`ê°€ ì•„ë‹˜)
- ì‚¬ìš©ì íƒ€ì… enum: `'admin' | 'member' | 'quest'`
- ë³´ì•ˆì„ ìœ„í•´ í•­ìƒ RLS ì •ì±… í¬í•¨
- ì™¸ë˜ í‚¤ëŠ” `auth.users(id)`ë¥¼ ì°¸ì¡°í•˜ë©° `ON DELETE CASCADE` ì‚¬ìš©

### SQL íŒŒì¼ ê´€ë¦¬

**íŒŒì¼ ìœ„ì¹˜**: ëª¨ë“  SQL íŒŒì¼ì€ `sql/` ë””ë ‰í† ë¦¬ì— ì €ì¥

**íŒŒì¼ ëª…ëª… ê·œì¹™**:
```
sql/
â”œâ”€â”€ YYYYMMDD_initial_schema.sql      # ì´ˆê¸° ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ YYYYMMDD_add_user_types.sql      # ë§ˆì´ê·¸ë ˆì´ì…˜
â””â”€â”€ YYYYMMDD_create_indexes.sql      # ì¸ë±ìŠ¤ ì¶”ê°€
```

**SQL íŒŒì¼ êµ¬ì¡°**:
```sql
-- íŒŒì¼ ëª©ì : ì‚¬ìš©ì íƒ€ì… ë³€ê²½
-- ì˜ì¡´ì„±: user_profiles í…Œì´ë¸” í•„ìš”
-- ì‘ì„±ì¼: 2024-01-01

-- ê¸°ì¡´ ì œì•½ ì¡°ê±´ ì‚­ì œ
ALTER TABLE user_profiles DROP CONSTRAINT IF EXISTS ...;

-- ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
UPDATE user_profiles SET ...;

-- ìƒˆ ì œì•½ ì¡°ê±´ ì¶”ê°€
ALTER TABLE user_profiles ADD CONSTRAINT ...;
```

## í™˜ê²½ ë³€ìˆ˜

`.env.local`ì— í•„ìˆ˜ í•­ëª©:
```
NEXT_PUBLIC_SUPABASE_URL=your_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

## ì¼ë°˜ì ì¸ ë¬¸ì œ

**í•« ë¦¬ë¡œë“œê°€ ì‘ë™í•˜ì§€ ì•Šì„ ë•Œ**:
```bash
rm -rf .next && npm run dev
```

**ì—¬ëŸ¬ ê°œë°œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¼ ë•Œ**: ìœ„ì˜ í¬íŠ¸ ì¢…ë£Œ ëª…ë ¹ì–´ ì‚¬ìš©

**ì¸ì¦ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë£¨í”„**: `user_profiles` í…Œì´ë¸”ì´ ì¡´ì¬í•˜ê³  RLS ì •ì±…ì´ ì½ê¸° ì ‘ê·¼ì„ í—ˆìš©í•˜ëŠ”ì§€ í™•ì¸

**ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•Šì„ ë•Œ**: `next.config.js`ì˜ remotePatternsì— ë„ë©”ì¸ì´ ìˆëŠ”ì§€ í™•ì¸
