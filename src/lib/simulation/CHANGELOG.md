# ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ë³€ê²½ ë‚´ì—­

## ğŸ“… 2025-10-24

### ğŸ”„ ì£¼ìš” ë³€ê²½ì‚¬í•­: ìš”êµ¬ì‚¬í•­ì— ë§ì¶˜ ë§¤ìˆ˜/ë§¤ë„ ë¡œì§ ìˆ˜ì •

#### 1. **ë§¤ìˆ˜ ì¡°ê±´ ìˆ˜ì •** âœ…

**ë³€ê²½ ì „:**
```typescript
const buyCondition = min + (Math.abs(min) * buyThreshold)
shouldBuy = currentValue >= buyCondition
```

**ë³€ê²½ í›„:**
```typescript
const buyCondition = currentValue - min
shouldBuy = buyCondition > buyThreshold
```

**ì˜ë¯¸:**
- ê¸°ì¡´: ìµœì†Œê°’ì—ì„œ ì„ê³„ê°’ë§Œí¼ì˜ ë¹„ìœ¨ì„ ë”í•œ ê°’ê³¼ ë¹„êµ
- ë³€ê²½: í˜„ì¬ ê°’ê³¼ ìµœì†Œê°’ì˜ **ì°¨ì´**ê°€ ì„ê³„ê°’ë³´ë‹¤ í¬ë©´ ë§¤ìˆ˜

**ì˜ˆì‹œ:**
- `min = -0.5`, `buyThreshold = 0.7`, `currentValue = 0.3`
- ê¸°ì¡´ ë°©ì‹: `-0.1 >= -0.5 + 0.35 = -0.15` â†’ ë§¤ìˆ˜í•¨
- ìƒˆ ë°©ì‹: `0.3 - (-0.5) = 0.8 > 0.7` â†’ ë§¤ìˆ˜í•¨

---

#### 2. **ë§¤ë„ ì¡°ê±´ ìˆ˜ì •** âœ…

**ë³€ê²½ ì „:**
```typescript
const sellCondition = max - (Math.abs(max) * sellThreshold)
shouldSell = currentValue <= sellCondition
```

**ë³€ê²½ í›„:**
```typescript
const sellCondition = currentValue - max
shouldSell = sellCondition < sellThreshold
```

**ì˜ë¯¸:**
- ê¸°ì¡´: ìµœëŒ€ê°’ì—ì„œ ì„ê³„ê°’ë§Œí¼ì˜ ë¹„ìœ¨ì„ ëº€ ê°’ê³¼ ë¹„êµ
- ë³€ê²½: í˜„ì¬ ê°’ê³¼ ìµœëŒ€ê°’ì˜ **ì°¨ì´**ê°€ ì„ê³„ê°’(ìŒìˆ˜)ë³´ë‹¤ ì‘ìœ¼ë©´ ë§¤ë„

**ì˜ˆì‹œ:**
- `max = 0.8`, `sellThreshold = -0.5`, `currentValue = 0.2`
- ê¸°ì¡´ ë°©ì‹: `0.3 <= 0.8 - 0.4 = 0.4` â†’ ë§¤ë„í•¨
- ìƒˆ ë°©ì‹: `0.2 - 0.8 = -0.6 < -0.5` â†’ ë§¤ë„í•¨

---

#### 3. **ì´ˆê¸° í¬ì§€ì…˜ ì ìš©** âœ…

**ì¶”ê°€ ê¸°ëŠ¥:**
```typescript
export interface SimulationConfig {
  // ... ê¸°ì¡´ í•„ë“œë“¤
  initialPosition?: 'cash' | 'coin' // ìƒˆë¡œ ì¶”ê°€
}
```

**ì ìš© ë°©ë²•:**
```typescript
// tradingSimulation.ts
const initialPrice = fiveMin[0].close
let tradingPosition = createInitialPosition(
  config.initialPosition || 'cash',
  initialPrice
)
```

**ì˜ë¯¸:**
- `'cash'` (ê¸°ë³¸ê°’): í˜„ê¸ˆ ë³´ìœ  ìƒíƒœë¡œ ì‹œì‘ â†’ ì²« ë§¤ìˆ˜ê¹Œì§€ ìˆ˜ìµë¥  0%
- `'coin'`: ì½”ì¸ ë³´ìœ  ìƒíƒœë¡œ ì‹œì‘ â†’ ì²« ë§¤ë„ê¹Œì§€ ìˆ˜ìµë¥ ì€ í™€ë“œ ìˆ˜ìµë¥ ê³¼ ë™ì¼

---

#### 4. **ì„ê³„ê°’ ë²”ìœ„ ëª…í™•í™”** âœ…

**ë§¤ìˆ˜ ì„ê³„ê°’:**
- ë²”ìœ„: `0.0 ~ 2.0` (ì ˆëŒ€ê°’)
- ì˜ë¯¸: í˜„ì¬ ê°’ì´ ìµœì†Œê°’ë³´ë‹¤ ì´ ê°’ë§Œí¼ ì»¤ì•¼ ë§¤ìˆ˜ (ì°¨ì´ê°’ ê¸°ì¤€)

**ë§¤ë„ ì„ê³„ê°’:**
- ë²”ìœ„: `-2.0 ~ 0.0` (ìŒìˆ˜)
- ì˜ë¯¸: í˜„ì¬ ê°’ì´ ìµœëŒ€ê°’ë³´ë‹¤ ì´ ê°’(ìŒìˆ˜)ë§Œí¼ ì‘ì•„ì•¼ ë§¤ë„ (ì°¨ì´ê°’ ê¸°ì¤€)

---

### ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

#### TypeScript íŒŒì¼
1. âœ… `src/lib/simulation/tradingRules.ts`
   - `checkBuyCondition()` í•¨ìˆ˜ ë¡œì§ ìˆ˜ì •
   - `checkSellCondition()` í•¨ìˆ˜ ë¡œì§ ìˆ˜ì •

2. âœ… `src/lib/simulation/tradingSimulation.ts`
   - `SimulationConfig` ì¸í„°í˜ì´ìŠ¤ì— `initialPosition` í•„ë“œ ì¶”ê°€
   - `runTradingSimulation()` í•¨ìˆ˜ì—ì„œ `createInitialPosition()` ì‚¬ìš©

3. âœ… `src/lib/simulation/README.md`
   - ë§¤ìˆ˜/ë§¤ë„ ë¡œì§ ì„¤ëª… ì—…ë°ì´íŠ¸
   - ì˜ˆì‹œ ìˆ˜ì •

#### Web Worker íŒŒì¼
4. âœ… `public/simulation-worker.js`
   - `runTradingSimulation()` í•¨ìˆ˜ì˜ ë§¤ìˆ˜/ë§¤ë„ ì¡°ê±´ ìˆ˜ì •
   - `runDetailedSimulation()` í•¨ìˆ˜ì˜ ë§¤ìˆ˜/ë§¤ë„ ì¡°ê±´ ìˆ˜ì •

#### UI íŒŒì¼
5. âœ… `src/app/simulation/[symbol]/TradingSimulationContent.tsx`
   - ë§¤ìˆ˜ ì„ê³„ê°’ ê²€ì¦ ë¡œì§: `0.0 ~ 1.0` â†’ `0.0 ~ 2.0` ìˆ˜ì •
   - ë§¤ë„ ì„ê³„ê°’ ê²€ì¦ ë¡œì§: `0.0 ~ 1.0` â†’ `-2.0 ~ 0.0` ìˆ˜ì •
   - ëª¨ë°”ì¼ UI input í•„ë“œ max ì†ì„± ìˆ˜ì • (ë§¤ìˆ˜: 2.0, ë§¤ë„: 0.0)
   - ë°ìŠ¤í¬í†± UI input í•„ë“œ max ì†ì„± ìˆ˜ì • (ë§¤ìˆ˜: 2.0, ë§¤ë„: 0.0)
   - ë§¤ë„ ì„ê³„ê°’ input í•„ë“œ min ì†ì„± ìˆ˜ì •: `0.0` â†’ `-2.0`

#### í…ŒìŠ¤íŠ¸ íŒŒì¼
6. âœ… `tests/simulation-logic.test.ts`
   - ë§¤ìˆ˜ ì¡°ê±´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìˆ˜ì •
   - ë§¤ë„ ì¡°ê±´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìˆ˜ì •
   - ì „ì²´ ì‹œë®¬ë ˆì´ì…˜ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ìˆ˜ì •

---

### âœ… ê²€ì¦ ì™„ë£Œ

```bash
# 1. ë¦°íŠ¸ ì²´í¬
npm run lint
# âœ… No ESLint warnings or errors

# 2. íƒ€ì… ì²´í¬
npx tsc --noEmit
# âœ… No TypeScript errors

# 3. ë¹Œë“œ ì²´í¬
npm run build
# âœ… Compiled successfully
```

---

### ğŸ“Š ë³€ê²½ ì „í›„ ë¹„êµ

| í•­ëª© | ë³€ê²½ ì „ | ë³€ê²½ í›„ |
|------|---------|---------|
| ë§¤ìˆ˜ ì¡°ê±´ | `currentValue >= min + (|min| Ã— threshold)` | `(currentValue - min) > threshold` |
| ë§¤ë„ ì¡°ê±´ | `currentValue <= max - (|max| Ã— threshold)` | `(currentValue - max) < threshold` |
| ë§¤ìˆ˜ ì„ê³„ê°’ ë²”ìœ„ | 0.0 ~ 1.0 (ë¹„ìœ¨) | 0.0 ~ 2.0 (ì ˆëŒ€ê°’) |
| ë§¤ë„ ì„ê³„ê°’ ë²”ìœ„ | 0.0 ~ 1.0 (ë¹„ìœ¨) | -2.0 ~ 0.0 (ì ˆëŒ€ê°’, ìŒìˆ˜) |
| ì´ˆê¸° í¬ì§€ì…˜ | í•­ìƒ í˜„ê¸ˆ | í˜„ê¸ˆ ë˜ëŠ” ì½”ì¸ ì„ íƒ ê°€ëŠ¥ |

---

### ğŸ¯ ê²°ë¡ 

ìš”êµ¬ì‚¬í•­ì— ë§ì¶° ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤:
1. âœ… ë§¤ìˆ˜/ë§¤ë„ ì¡°ê±´ì´ **ì°¨ì´ê°’ ê¸°ë°˜**ìœ¼ë¡œ ë³€ê²½
2. âœ… ì„ê³„ê°’ì´ **ì ˆëŒ€ê°’**ìœ¼ë¡œ ë³€ê²½ (ë§¤ë„ëŠ” ìŒìˆ˜ ë²”ìœ„)
3. âœ… **ì´ˆê¸° í¬ì§€ì…˜** ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€
4. âœ… TypeScript, Web Worker, í…ŒìŠ¤íŠ¸ ëª¨ë‘ ë™ê¸°í™”
5. âœ… ë¦°íŠ¸, íƒ€ì… ì²´í¬, ë¹Œë“œ ëª¨ë‘ í†µê³¼

ì´ì œ ì‹œë®¬ë ˆì´ì…˜ì€ ìš”êµ¬ì‚¬í•­ê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë¡œì§ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

---

## ğŸ“… 2025-10-24 (ì¶”ê°€)

### ğŸ’¾ localStorage ìë™ ì €ì¥ ê¸°ëŠ¥

#### êµ¬í˜„ ë‚´ìš©
ì‚¬ìš©ìê°€ ì„¤ì •í•œ ê°’ë“¤ì„ ë¸Œë¼ìš°ì €ì˜ localStorageì— ìë™ìœ¼ë¡œ ì €ì¥í•˜ê³ , í˜ì´ì§€ë¥¼ ë‹¤ì‹œ ë°©ë¬¸í•  ë•Œ ì´ì „ ì„¤ì •ê°’ì„ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.

#### ì €ì¥ë˜ëŠ” ì„¤ì •ê°’
- **ê±°ë˜ì†Œ**: exchange (binance, upbit)
- **ê¸°ê°„**: period (1M, 3M, 6M, 1Y)
- **íƒ€ì„í”„ë ˆì„**: timeFrame (1h, 2h, 4h, 1d)
- **ì§€í‘œ ì„¤ì •**: indicators (macd, rsi, ao, DP, rti)
- **ë§¤ìˆ˜ ì¡°ê±´ ê°œìˆ˜**: buyConditionCount
- **ë§¤ë„ ì¡°ê±´ ê°œìˆ˜**: sellConditionCount
- **ë§¤ìˆ˜ ì„ê³„ê°’ ë²”ìœ„**: buyThresholdMin, buyThresholdMax
- **ë§¤ë„ ì„ê³„ê°’ ë²”ìœ„**: sellThresholdMin, sellThresholdMax
- **ì†Œìˆ˜ì  ìë¦¿ìˆ˜**: decimalPlaces (2 ë˜ëŠ” 3)
- **ì´ˆê¸° í¬ì§€ì…˜**: initialPosition (cash ë˜ëŠ” coin)

#### ê¸°ìˆ  êµ¬í˜„
```typescript
// localStorage í‚¤ ìƒì„± (ì½”ì¸ë³„ë¡œ êµ¬ë¶„)
const getStorageKey = (key: string) => `simulation_${symbol}_${key}`

// ì´ˆê¸°ê°’ ë¶ˆëŸ¬ì˜¤ê¸° (SSR ì•ˆì „)
const [exchange, setExchange] = useState<Exchange>(() => 
  getStoredValue('exchange', 'binance')
)

// ê°’ ë³€ê²½ ì‹œ ìë™ ì €ì¥
useEffect(() => {
  if (typeof window === 'undefined') return
  localStorage.setItem(getStorageKey('exchange'), JSON.stringify(exchange))
}, [exchange, getStorageKey])
```

#### íŠ¹ì§•
- âœ… ì½”ì¸ë³„ë¡œ ë…ë¦½ì ì¸ ì„¤ì • ì €ì¥ (BTC, ETH ë“± ê°ê° ë‹¤ë¥¸ ì„¤ì • ìœ ì§€)
- âœ… SSR ì•ˆì „ (ì„œë²„ ë Œë”ë§ ì‹œ localStorage ì ‘ê·¼ ë°©ì§€)
- âœ… ìë™ ì €ì¥ (ì„¤ì • ë³€ê²½ ì‹œ ì¦‰ì‹œ ì €ì¥)
- âœ… ìë™ ë¶ˆëŸ¬ì˜¤ê¸° (í˜ì´ì§€ ì¬ë°©ë¬¸ ì‹œ ì´ì „ ì„¤ì • ë³µì›)
- âœ… ê¸°ë³¸ê°’ í´ë°± (ì €ì¥ëœ ê°’ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)

#### ìˆ˜ì •ëœ íŒŒì¼
1. âœ… `src/app/simulation/[symbol]/TradingSimulationContent.tsx`
   - `getStorageKey()` í—¬í¼ í•¨ìˆ˜ ì¶”ê°€
   - `getStoredValue()` í—¬í¼ í•¨ìˆ˜ ì¶”ê°€
   - ëª¨ë“  ì„¤ì • stateì— localStorage ì´ˆê¸°ê°’ ì ìš©
   - ê° ì„¤ì •ê°’ì— ëŒ€í•œ useEffect ì €ì¥ ë¡œì§ ì¶”ê°€ (12ê°œ)

#### ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
ì´ì œ ì‚¬ìš©ìëŠ” ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •ì„ ë§¤ë²ˆ ë‹¤ì‹œ ì…ë ¥í•  í•„ìš” ì—†ì´, ì´ì „ì— ì‚¬ìš©í–ˆë˜ ì„¤ì •ê°’ì´ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤. ê° ì½”ì¸ë§ˆë‹¤ ë…ë¦½ì ì¸ ì„¤ì •ì„ ìœ ì§€í•˜ë¯€ë¡œ, BTCì—ì„œ ì‚¬ìš©í•œ ì„¤ì •ì´ ETH ì‹œë®¬ë ˆì´ì…˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

## ğŸ“… 2025-10-24 (ë²„ê·¸ ìˆ˜ì •)

### ğŸ› í™€ë“œ ìˆ˜ìµë¥  ê³„ì‚° ë²„ê·¸ ìˆ˜ì •

#### ë¬¸ì œì 
ì´ˆê¸° í¬ì§€ì…˜ì´ "í˜„ê¸ˆ"ì¸ ê²½ìš°, ì²« ë§¤ìˆ˜ ì „ê¹Œì§€ í™€ë“œ ìˆ˜ìµë¥ ì´ 0%ê°€ ì•„ë‹Œ ê°’ìœ¼ë¡œ ê³„ì‚°ë˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

#### ì›ì¸
í™€ë“œ ìˆ˜ìµë¥  ê³„ì‚° ì‹œ í•­ìƒ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ ì‹œì ì˜ ê°€ê²©ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
```javascript
// ì˜ëª»ëœ ì½”ë“œ
const initialPrice = analysisStartPrice  // í•­ìƒ ì‹œì‘ ì‹œì  ê°€ê²©
const holdReturn = ((currentPrice - initialPrice) / initialPrice) * 100
```

#### ìˆ˜ì • ë‚´ìš©
ì´ˆê¸° í¬ì§€ì…˜ì— ë”°ë¼ í™€ë“œ ìˆ˜ìµë¥  ê¸°ì¤€ ê°€ê²©ì„ ë‹¤ë¥´ê²Œ ì„¤ì •:

**ì´ˆê¸° í¬ì§€ì…˜ì´ ì½”ì¸ì¸ ê²½ìš°:**
- í™€ë“œ ê¸°ì¤€ ê°€ê²© = ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ ì‹œì  ê°€ê²©
- ì‹œì‘ë¶€í„° ì½”ì¸ì„ ë³´ìœ í•˜ê³  ìˆìœ¼ë¯€ë¡œ ì‹œì‘ ì‹œì  ê°€ê²© ê¸°ì¤€

**ì´ˆê¸° í¬ì§€ì…˜ì´ í˜„ê¸ˆì¸ ê²½ìš°:**
- í™€ë“œ ê¸°ì¤€ ê°€ê²© = ì²« ë§¤ìˆ˜ ì‹œì  ê°€ê²©
- ì²« ë§¤ìˆ˜ ì „ê¹Œì§€ëŠ” í™€ë“œ ìˆ˜ìµë¥  = 0%
- ì²« ë§¤ìˆ˜ ì´í›„ë¶€í„° í™€ë“œ ìˆ˜ìµë¥  ê³„ì‚° ì‹œì‘

```javascript
// ìˆ˜ì •ëœ ì½”ë“œ
let holdBasePrice = null

// ì´ˆê¸° í¬ì§€ì…˜ì´ ì½”ì¸ì´ë©´
if (initialPosition === 'coin') {
  holdBasePrice = analysisStartPrice  // ì‹œì‘ ì‹œì  ê°€ê²©
}

// ì²« ë§¤ìˆ˜ ì‹œ
if (buyCondition > config.buyThreshold) {
  // ... ë§¤ìˆ˜ ë¡œì§
  if (holdBasePrice === null) {
    holdBasePrice = currentPrice  // ì²« ë§¤ìˆ˜ ê°€ê²©ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •
  }
}

// í™€ë“œ ìˆ˜ìµë¥  ê³„ì‚°
let holdReturn = 0
if (holdBasePrice !== null) {
  holdReturn = ((currentPrice - holdBasePrice) / holdBasePrice) * 100
}
```

#### ìˆ˜ì •ëœ íŒŒì¼
1. âœ… `public/simulation-worker.js`
   - `runDetailedSimulation()` í•¨ìˆ˜ì˜ í™€ë“œ ìˆ˜ìµë¥  ê³„ì‚° ë¡œì§ ìˆ˜ì •
   - `holdBasePrice` ë³€ìˆ˜ ì¶”ê°€ ë° ì´ˆê¸° í¬ì§€ì…˜ì— ë”°ë¥¸ ì¡°ê±´ë¶€ ì„¤ì •

#### ê²°ê³¼
- âœ… ì´ˆê¸° í¬ì§€ì…˜ì´ "í˜„ê¸ˆ"ì¸ ê²½ìš°, ì²« ë§¤ìˆ˜ ì „ê¹Œì§€ í™€ë“œ ìˆ˜ìµë¥ ì´ 0%ë¡œ í‘œì‹œë©ë‹ˆë‹¤
- âœ… ì²« ë§¤ìˆ˜ ì‹œì ë¶€í„° í™€ë“œ ìˆ˜ìµë¥ ì´ ì •í™•í•˜ê²Œ ê³„ì‚°ë©ë‹ˆë‹¤
- âœ… ì´ˆê¸° í¬ì§€ì…˜ì´ "ì½”ì¸"ì¸ ê²½ìš°, ì‹œì‘ ì‹œì ë¶€í„° í™€ë“œ ìˆ˜ìµë¥ ì´ ê³„ì‚°ë©ë‹ˆë‹¤
  
